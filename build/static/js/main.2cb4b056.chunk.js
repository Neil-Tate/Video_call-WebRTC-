(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{37:function(e,t,n){e.exports=n(76)},42:function(e,t,n){},71:function(e,t){},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),i=n(35),r=n.n(i),l=(n(42),n(2)),o=n(3),s=n(9),u=n(8),d=n(7),f=n(4),h=n.n(f),m=n(36),p=n.n(m).a.connect("https://nameless-depths-63913.herokuapp.com/"),v=function(){function e(){Object(l.a)(this,e),this.events={}}return Object(o.a)(e,[{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return this.events[e]&&this.events[e].forEach((function(e){return e.apply(void 0,n)})),this}},{key:"on",value:function(e,t){return this.events[e]?this.events[e].push(t):this.events[e]=[t],this}},{key:"off",value:function(e,t){if(e&&h.a.isFunction(t)){var n=this.events[e],a=n.findIndex((function(e){return e===t}));n.splice(a,1)}else this.events[e]=[];return this}}]),e}(),b=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(l.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"start",value:function(){var e=this;return navigator.mediaDevices.getUserMedia({video:{facingMode:"user",height:{min:360,ideal:720,max:1080}},audio:!0}).then((function(t){e.stream=t,e.emit("stream",t)})).catch((function(e){e instanceof DOMException?alert("Cannot open webcam and/or microphone"):console.log(e)})),this}},{key:"toggle",value:function(e,t){var n=arguments.length;return this.stream&&this.stream["get".concat(e,"Tracks")]().forEach((function(e){var a=2===n?t:!e.enabled;h.a.set(e,"enabled",a)})),this}},{key:"stop",value:function(){return this.stream&&this.stream.getTracks().forEach((function(e){return e.stop()})),this}}]),n}(v),g={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},C=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(l.a)(this,n),(a=t.call(this)).pc=new RTCPeerConnection(g),a.pc.onicecandidate=function(e){return p.emit("call",{to:a.friendID,candidate:e.candidate})},a.pc.ontrack=function(e){return a.emit("peerStream",e.streams[0])},a.mediaDevice=new b,a.friendID=e,a}return Object(o.a)(n,[{key:"start",value:function(e,t){var n=this;return this.mediaDevice.on("stream",(function(t){t.getTracks().forEach((function(e){n.pc.addTrack(e,t)})),n.emit("localStream",t),e?p.emit("request",{to:n.friendID}):n.createOffer()})).start(t),this}},{key:"stop",value:function(e){return e&&p.emit("end",{to:this.friendID}),this.mediaDevice.stop(),this.pc.close(),this.pc=null,this.off(),this}},{key:"createOffer",value:function(){return this.pc.createOffer().then(this.getDescription.bind(this)).catch((function(e){return console.log(e)})),this}},{key:"createAnswer",value:function(){return this.pc.createAnswer().then(this.getDescription.bind(this)).catch((function(e){return console.log(e)})),this}},{key:"getDescription",value:function(e){return this.pc.setLocalDescription(e),p.emit("call",{to:this.friendID,sdp:e}),this}},{key:"setRemoteDescription",value:function(e){var t=new RTCSessionDescription(e);return this.pc.setRemoteDescription(t),this}},{key:"addIceCandidate",value:function(e){if(e){var t=new RTCIceCandidate(e);this.pc.addIceCandidate(t)}return this}}]),n}(v),y=n(11);var E=function(e){var t=e.startCall,n=e.clientId,i=Object(a.useState)(null),r=Object(y.a)(i,2),l=r[0],o=r[1],s=function(e){var n={audio:!0,video:e};return function(){return l&&t(!0,l,n)}};return c.a.createElement("div",{className:"container main-window"},c.a.createElement("div",null,c.a.createElement("h3",null,"Hi, your ID is",c.a.createElement("input",{type:"text",className:"txt-clientId",defaultValue:n,readOnly:!0})),c.a.createElement("h4",null,"Get started by calling a friend below")),c.a.createElement("div",null,c.a.createElement("input",{type:"text",className:"txt-clientId",spellCheck:!1,placeholder:"Your friend ID",onChange:function(e){return o(e.target.value)}}),c.a.createElement("div",null,c.a.createElement("button",{type:"button",className:"btn-action fa fa-video-camera",onClick:s(!0)}),c.a.createElement("button",{type:"button",className:"btn-action fa fa-phone",onClick:s(!1)}))))},k=n(10),j=n.n(k),O=function(e,t){return j()("btn-action fa ".concat(e),{disable:!t})};var S=function(e){var t=e.peerSrc,n=e.localSrc,i=e.config,r=e.mediaDevice,l=e.status,o=e.endCall,s=Object(a.useRef)(null),u=Object(a.useRef)(null),d=Object(a.useState)(i.video),f=Object(y.a)(d,2),h=f[0],m=f[1],p=Object(a.useState)(i.audio),v=Object(y.a)(p,2),b=v[0],g=v[1];Object(a.useEffect)((function(){s.current&&t&&(s.current.srcObject=t),u.current&&n&&(u.current.srcObject=n)})),Object(a.useEffect)((function(){r&&(r.toggle("Video",h),r.toggle("Audio",b))}));var C=function(e){"video"===e&&(m(!h),r.toggle("Video")),"audio"===e&&(g(!b),r.toggle("Audio"))};return c.a.createElement("div",{className:j()("call-window",l)},c.a.createElement("video",{id:"peerVideo",ref:s,autoPlay:!0}),c.a.createElement("video",{id:"localVideo",ref:u,autoPlay:!0,muted:!0}),c.a.createElement("div",{className:"video-control"},c.a.createElement("button",{key:"btnVideo",type:"button",className:O("fa-video-camera",h),onClick:function(){return C("video")}}),c.a.createElement("button",{key:"btnAudio",type:"button",className:O("fa-microphone",b),onClick:function(){return C("audio")}}),c.a.createElement("button",{type:"button",className:"btn-action hangup fa fa-phone",onClick:function(){return o(!0)}})))};var w=function(e){var t=e.status,n=e.callFrom,a=e.startCall,i=e.rejectCall,r=function(e){var t={audio:!0,video:e};return function(){return a(!1,n,t)}};return c.a.createElement("div",{className:j()("call-modal",t)},c.a.createElement("p",null,c.a.createElement("span",{className:"caller"},"".concat(n," is calling"))),c.a.createElement("button",{type:"button",className:"btn-action fa fa-video-camera",onClick:r(!0)}),c.a.createElement("button",{type:"button",className:"btn-action fa fa-phone",onClick:r(!1)}),c.a.createElement("button",{type:"button",className:"btn-action hangup fa fa-phone",onClick:i}))},D=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;return Object(l.a)(this,n),(e=t.call(this)).state={clientId:"",callWindow:"",callModal:"",callFrom:"",localSrc:null,peerSrc:null},e.pc={},e.config=null,e.startCallHandler=e.startCall.bind(Object(s.a)(e)),e.endCallHandler=e.endCall.bind(Object(s.a)(e)),e.rejectCallHandler=e.rejectCall.bind(Object(s.a)(e)),e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;p.on("init",(function(t){var n=t.id;document.title="".concat(n," - VideoCall"),e.setState({clientId:n})})).on("request",(function(t){var n=t.from;e.setState({callModal:"active",callFrom:n})})).on("call",(function(t){t.sdp?(e.pc.setRemoteDescription(t.sdp),"offer"===t.sdp.type&&e.pc.createAnswer()):e.pc.addIceCandidate(t.candidate)})).on("end",this.endCall.bind(this,!1)).emit("init")}},{key:"startCall",value:function(e,t,n){var a=this;this.config=n,this.pc=new C(t).on("localStream",(function(t){var n={callWindow:"active",localSrc:t};e||(n.callModal=""),a.setState(n)})).on("peerStream",(function(e){return a.setState({peerSrc:e})})).start(e,n)}},{key:"rejectCall",value:function(){var e=this.state.callFrom;p.emit("end",{to:e}),this.setState({callModal:""})}},{key:"endCall",value:function(e){h.a.isFunction(this.pc.stop)&&this.pc.stop(e),this.pc={},this.config=null,this.setState({callWindow:"",callModal:"",localSrc:null,peerSrc:null})}},{key:"render",value:function(){var e=this.state,t=e.clientId,n=e.callFrom,a=e.callModal,i=e.callWindow,r=e.localSrc,l=e.peerSrc;return c.a.createElement("div",null,c.a.createElement(E,{clientId:t,startCall:this.startCallHandler}),!h.a.isEmpty(this.config)&&c.a.createElement(S,{status:i,localSrc:r,peerSrc:l,config:this.config,mediaDevice:this.pc.mediaDevice,endCall:this.endCallHandler}),c.a.createElement(w,{status:a,startCall:this.startCallHandler,rejectCall:this.rejectCallHandler,callFrom:n}))}}]),n}(a.Component);n(74);var I=function(){return c.a.createElement("div",{className:"App"},c.a.createElement(D,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(75);r.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(I,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[37,1,2]]]);
//# sourceMappingURL=main.2cb4b056.chunk.js.map